{
  "version": 3,
  "file": "rule-ex.js",
  "sourceRoot": "..\\..\\",
  "sources": [
    "src\\lib\\rule-ex.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# rule-ex.coffee\r\n\r\nimport {\r\n\tundef, defined, notdefined, OL, ML, hasKey, identityFunc,\r\n\tisString, isInteger, isArray,\r\n\tassert, croak, getOptions,\r\n\t} from '@jdeighan/llutils'\r\nimport {MultiMap} from '@jdeighan/llutils/multi-map'\r\n\r\nraisedDot = 'â€¢'\r\nexport phi = 'Î¦'\r\n\r\n# ---------------------------------------------------------------------------\r\n#     class RuleEx\r\n# ---------------------------------------------------------------------------\r\n\r\nexport class RuleEx\r\n\r\n\t@nextID: 0\r\n\t@resetNextID: () =>\r\n\t\t@nextID = 0\r\n\t\treturn\r\n\t@getNextID: () =>\r\n\t\tid = @nextID\r\n\t\t@nextID += 1\r\n\t\treturn id\r\n\r\n\t@mm: new MultiMap(3)\r\n\t@getNew: (hRule, src, pos=0) =>\r\n\t\tobj = @mm.get([hRule, src, pos])\r\n\t\tif defined(obj)\r\n\t\t\treturn obj\r\n\t\telse\r\n\t\t\tobj = new RuleEx(hRule, src, pos)\r\n\t\t\t@mm.set [hRule, src, pos], obj\r\n\t\t\treturn obj\r\n\r\n\tconstructor: (@hRule, @src, @pos=0) ->\r\n\r\n\t\t@id = RuleEx.getNextID()\r\n\r\n\t\tcheckRule(@hRule, @id)\r\n\r\n\t\t# --- Copy fields from hRule to this object\r\n\t\t@type = @hRule.type\r\n\t\t@head = @hRule.head\r\n\t\t@lParts = @hRule.lParts\r\n\r\n\t\tassert isInteger(@src), \"Not an int: #{OL(@src)}\"\r\n\t\t@maxpos = @lParts.length\r\n\r\n\tnextPart: () ->     # --- may return undef\r\n\r\n\t\treturn @lParts[@pos]\r\n\r\n\tgetInc: () ->\r\n\r\n\t\tassert (@pos+1 <= @maxpos), \"Can't inc #{ML(this)}\"\r\n\t\treturn RuleEx.getNew(@hRule, @src, @pos+1)\r\n\r\n\tasString: () ->\r\n\r\n\t\treturn \"[#{@id}] #{ruleAsString(@hRule, {pos: @pos})} / #{@src}\"\r\n\r\n# ---------------------------------------------------------------------------\r\n# An hRule looks like:\r\n#    {\r\n#       type: 'rule'\r\n#       id: Int\r\n#       head: String\r\n#       lParts: [\r\n#          {\r\n#             type: 'terminal' | 'nonterminal',\r\n#             value: String\r\n#             }\r\n#          ]\r\n#       }\r\n# ---------------------------------------------------------------------------\r\n\r\nexport terminal = (value) ->\r\n\r\n\tassert [\r\n\t\tisString(value),\r\n\t\t(value.length == 1),\r\n\t\t], \"Bad terminal: #{OL(value)}\"\r\n\treturn {\r\n\t\ttype: 'terminal'\r\n\t\tvalue\r\n\t\t}\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport nonterminal = (name) ->\r\n\r\n\tassert isString(name), \"bad nonterminal: #{OL(name)}\"\r\n\treturn {\r\n\t\ttype: 'nonterminal'\r\n\t\tvalue: name\r\n\t\t}\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport checkRule = (hRule, id=1) ->\r\n\r\n\tassert [\r\n\t\t(hRule.type == \"rule\"),\r\n\t\thasKey(hRule, 'head'),\r\n\t\tisString(hRule.head),\r\n\t\thasKey(hRule, 'lParts'),\r\n\t\tisArray(hRule.lParts),\r\n\t\t], \"Bad rule: #{OL(hRule)}\"\r\n\treturn\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport ruleFromString = (str, hOptions={}) ->\r\n\r\n\t{classify} = getOptions hOptions, {\r\n\t\tclassify: (s) =>\r\n\t\t\tif s.match(/^[A-Z][A-Za-z]*$/)\r\n\t\t\t\treturn 'nonterminal'\r\n\t\t\telse\r\n\t\t\t\treturn 'terminal'\r\n\t\t}\r\n\tlParts = str.split(/\\s+/)\r\n\tassert [\r\n\t\t(lParts.length > 2),\r\n\t\t(lParts[1] == '->'),\r\n\t\t(classify(lParts[0]) == 'nonterminal')\r\n\t\t], \"Bad rule: #{OL(str)}\"\r\n\treturn {\r\n\t\ttype: 'rule'\r\n\t\thead: lParts[0]\r\n\t\tlParts: lParts.slice(2).map((x) =>\r\n\t\t\tswitch classify(x)\r\n\t\t\t\twhen 'nonterminal'\r\n\t\t\t\t\t{type: 'nonterminal', value: x}\r\n\t\t\t\twhen 'terminal'\r\n\t\t\t\t\t{type: 'terminal', value: x}\r\n\t\t\t\telse\r\n\t\t\t\t\tcroak \"Bad rule: #{OL(str)}\"\r\n\t\t\t)\r\n\t\t}\r\n# ---------------------------------------------------------------------------\r\n\r\nexport ruleAsString = (hRule, hOptions={}) ->\r\n\r\n\t{pos, transformTerminal, transformNonTerminal} = getOptions hOptions, {\r\n\t\tpos: undef\r\n\t\ttransformTerminal: identityFunc\r\n\t\ttransformNonTerminal: identityFunc\r\n\t\t}\r\n\r\n\tlRHS = hRule.lParts.map(\r\n\t\t(hPart) =>\r\n\t\t\tswitch hPart.type\r\n\t\t\t\twhen \"terminal\"\r\n\t\t\t\t\treturn transformTerminal(hPart.value)\r\n\t\t\t\twhen \"nonterminal\"\r\n\t\t\t\t\treturn transformNonTerminal(hPart.value)\r\n\t\t)\r\n\tif defined(pos)\r\n\t\tlRHS.splice pos, 0, raisedDot\r\n\trhs = lRHS.join(\" \")\r\n\treturn \"#{hRule.head} -> #{rhs}\"\r\n"
  ]
}